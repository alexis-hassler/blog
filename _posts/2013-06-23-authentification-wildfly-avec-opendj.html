---
layout: post
title: Authentification WildFly avec OpenDJ
author: Alexis Hassler
tags:
- JBossAS7
- WildFly
- JAAS
- LDAP
courses:
- wildfly
---

Une fois de plus j'ai tatonné pour mettre en place une authentification LDAP dans JBoss AS / WildFly. Je trouve que la
configuration des security domains LDAP est peu intuitive, peut-être tout simplement parce que je ne suis pas très à
l'aise avec LDAP.<br /><br />Dans ce billet, je récapitule la configuration de mon serveur <a href="http://wildfly.org/"
    target="_blank">WildFly</a> pour gérer l'authentification de ses applications dans un serveur&nbsp;<a
    href="http://opendj.forgerock.org/" target="_blank">OpenDJ</a>.<br /><br />
<!--more-->
<br /><br />Dans un premier temps, j'ai installé OpenDJ. Pas grand chose à dire là-dessus, l'installation est
très simple et bien documentée. J'ai déclaré le root user sour le nom "cn=Sewatech" et j'ai créé un contenu très simple
avec un utilisateur et un groupe, l'utilisateur étant membre du groupe.<br /><br />
<div class="separator" style="clear: both; text-align: center;"><a
        href="http://3.bp.blogspot.com/-Nr2Nm35m-Ow/Ucbbco3fixI/AAAAAAAADJ4/_lmOCqBZL-0/s1600/ldap.png" imageanchor="1"
        style="margin-left: 1em; margin-right: 1em;"><img border="0" height="267"
            src="http://3.bp.blogspot.com/-Nr2Nm35m-Ow/Ucbbco3fixI/AAAAAAAADJ4/_lmOCqBZL-0/s320/ldap.png"
            width="320" /></a></div><br />La version LDIF est disponible <a
    href="https://gist.github.com/hasalex/5842614" target="_blank">ici</a>.<br /><br />Ensuite, j'ai installé WildFly.
Là non-plus pas grand chose à dire ; d'ailleurs, il n'y a pas de changement sur la procédure d'installation par rapport
JBoss AS 7. J'y ai déployé une application sécurisée avec un domaine de sécurité "swmsg-ldap", pour laquelle le rôle
"swmsg" est requis.<br /><br />Enfin, j'ai déclaré un security-domain, dans le fichier <b>standalone.xml</b>
:<br /><br /><br />Je n'ai pas choisi le module Ldap parce que les utilisateurs enregistrés dans mon annuaire ne peuvent
pas se connecter à l'annuaire. Le module <b>LdapExtended</b> permet de déclarer un login/password dédié pour se
connecter à l'annuaire LDAP. Pour ce module, j'utilise les paramètres suivants :<br />
<ul>
    <li>java.naming.provider.url : URL du serveur LDAP</li>
    <li>bindDN, bindCredential : login et mot de passe pour la connexion au serveur LDAP</li>
    <li>baseCtxDN : répertoire de base des utilisateurs</li>
    <li>baseFilter : filtre permettant de retrouver le login dans le DN de l'utilisateur</li>
    <li>rolesCtxDN : répertoire de base des rôles</li>
    <li>roleFilter : filtre permettant de retrouver les utilisateurs ayant un rôle</li>
    <li>roleAttributeID : attribut du rôle servant à identifier le groupe pour le module JAAS</li>
</ul>
<script src="https://gist.github.com/hasalex/5842518.js"></script> Avec tout ça, l'accès à l'application est possible en
s'authentifiant avec le login hasalex et le mot de passe aa.<br /><br />Le même résultat peut être obtenu avec l'outil
<b>jboss-cli</b>, en passant le script suivant :<br /><br />
<script src="https://gist.github.com/hasalex/5854155.js"></script><br /><br />Remarques :<br />
<ul>
    <li>La même configuration fonctionne aussi dans JBoss AS 7.1 ou 7.2.</li>
    <li>La liste des attributs de configuration du module LdapExtended est disponible sur le <a
            href="https://community.jboss.org/wiki/LdapExtLoginModule" target="_blank">wiki de JBoss</a>.</li>
</ul>