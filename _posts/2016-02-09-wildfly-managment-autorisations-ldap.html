---
layout: post
title: Gérer les droits d'accès des administrateurs WildFly avec un annuaire LDAP
date: '2016-02-09T08:30:00.000+01:00'
author: Alexis Hassler
tags:
- WildFly
- LDAP
modified_time: '2016-02-11T07:10:40.474+01:00'
thumbnail: https://3.bp.blogspot.com/-7ss8iLDPwy8/Vq8uvfzL_BI/AAAAAAAAGcA/hAEzJoB0f8o/s72-c/wildfly_logomark_150px.png
blogger_id: tag:blogger.com,1999:blog-1829028238633284708.post-4352761374736074622
blogger_orig_url: http://blog.alexis-hassler.com/2016/02/wildfly-managment-autorisations-ldap.html

---

<div class="separator" style="clear: both; text-align: center; float: right; "><img border="0" src="https://3.bp.blogspot.com/-7ss8iLDPwy8/Vq8uvfzL_BI/AAAAAAAAGcA/hAEzJoB0f8o/s1600/wildfly_logomark_150px.png" /></div><p>Dans mon <a href="/2016/02/wildfly-managment-authentification-ldap.html">billet précédent</a>, j'ai montré comment stocker les données d'authentification des administrateurs WildFly dans un annuaire LDAP. La solution n'était pas complète car on ne gérais pas les autorisations. </p><p>Pour ça, il faut activer le mode <b>RBAC</b> et affecter les rôles d'administration aux utilisateurs enregistrés. Pour le billet, on se contentera de deux rôles : celui d'<b>Administrator</b> qui a un accès en écriture à toutes les informations et celui de <b>Monitor</b> qui n'a accès qu'en lecture et qui ne peut pas voir les informations sensibles. On commence par les rôles et on activera le RBAC quand tout sera en place. </p><!--more--><p>Les <b>rôles</b> sont prédéfinis dans WildFly et on peut les affecter aux <b>utilisateurs</b> : </p><pre class="brush: bash"><br />cd /core-service=management/access=authorization<br /><br />./role-mapping=Administrator:add<br />./role-mapping=Administrator/include=hasalex                                      \<br />                    :add(name=hasalex, type=USER, realm=LdapRealm)<br /><br />./role-mapping=Monitor:add<br />./role-mapping=Monitor/include=momo                                               \<br />                    :add(name=momo, type=USER, realm=LdapRealm)<br /></pre><p>On pourra utiliser le login <i>hasalex</i> pour la console d'administration ou <a href="">jboss-cli</a>, et on utilisera <i>momo</i> pour le monitoring. Par contre, l'affectation des rôles se fait utilisateur par utilisateur ce qui est fastidieux si leur nombre augmente. Ce serait beacoup plus pratique d'exploiter les groupes LDAP. On va donc ignorer les role-mapping de type USER et faire comme si on n'avait jamais passé ces quatre commandes. </p><p>Du coté de l'annuaire LDAP, on va rechercher les <b>groupes</b> dont l'utilisateur est membre : </p><pre class="brush: bash"><br />cd /core-service=management/security-realm=LdapRealm<br />batch<br />./authorization=ldap:add(connection="LdapConnection")<br />./authorization=ldap/group-search=group-to-principal                              \<br />                    :add(group-name=SIMPLE, group-name-attribute=cn,              \<br />                         base-dn="ou=groups,dc=sewatech,dc=fr", recursive=true,   \<br />                         search-by=DISTINGUISHED_NAME,                            \<br />                         principal-attribute=uniqueMember)<br />run-batch<br /></pre><p>Par rapport à nos <a href="https://gist.github.com/hasalex/a5ffd764485540c4fdff">données</a>, l'utilisateur <i>hasalex</i> fait partie du groupe <i>as-admin</i> et <i>momo</i> fait partie de <i>as-mon</i>. Ça ne représente pas encore des rôles reconnus par WildFly, il faut associer ces groupes aux rôles prédéfinis : </p><pre class="brush: bash"><br />cd /core-service=management/access=authorization<br /><br />./role-mapping=Administrator:add<br />./role-mapping=Administrator/include=app-admin                                   \<br />                    :add(type=GROUP, realm=LdapRealm)<br /><br />./role-mapping=Monitor:add<br />./role-mapping=Monitor/include=app-mon                                           \<br />                    :add(type=GROUP, realm=LdapRealm)<br /></pre><p>Maintenant qu'on a configuré la recherche des utilisateurs et l'association des groupes aux rôles WildFly, on peut passer en mode RBAC. </p><pre class="brush: bash"><br />/core-service=management/access=authorization                                    \<br />                    :write-attribute(name=provider,value=rbac)<br /></pre><p>Ça y est, chacun est dans son rôle et nos informations sont bien gardées. Si on a conservé l'authentification locale automatique, ce mode de connexion donne le rôle SuperUser qui a encore un peu plus de droits qu'Administrator. </p>