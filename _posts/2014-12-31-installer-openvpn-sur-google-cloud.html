---
layout: post
title: Comment installer OpenVPN sur Google Cloud
date: '2014-12-31T14:05:00.000+01:00'
author: Alexis Hassler
tags:
- Google Compute Engine
- OpenVPN
- Google Cloud
modified_time: '2015-12-04T11:22:55.825+01:00'
thumbnail: "//2.bp.blogspot.com/-ief7DxMoUfQ/VKPpfIO-ezI/AAAAAAAAFXQ/Hxh7Yff9WLg/s72-c/S%C3%A9lection_001.png"
blogger_id: tag:blogger.com,1999:blog-1829028238633284708.post-7195463786843779830
blogger_orig_url: http://blog.alexis-hassler.com/2014/12/installer-openvpn-sur-google-cloud.html

---

Korben a fait un super article qui explique&nbsp;<a href="http://korben.info/installer-openvpn.html" target="_blank">comment s’installer un petit VPN maison quand on n’est pas un gros barbu</a>. Il détaille l'installation d'OpenVPN sur un serveur Ubuntu hébergé sur&nbsp;<a href="https://www.ovh.com/fr/vps/" target="_blank">VPS chez OVH</a>. Sa procédure est simple et facile à suivre, grâce à l'utilisation d'<a href="https://openvpn.net/index.php/access-server/download-openvpn-as-sw.html" target="_blank">Openvpn Access Server</a>.<br /><br />N'étant pas barbu non plus, j'ai bien aimé sa façon de faire. Cet article propose une adaptation pour une installation chez un autre hébergeur : <a href="https://cloud.google.com/" target="_blank">Google Compute Engine</a>. La procédure de Korben ne fonctionne pas en l'état à cause d'un environnement réseau différent. Je vais donc détailler les adaptations nécessaires.<br /><br /><!--more--><br /><b>Créer la machine virtuelle</b><br /><br />Avant de créer l'instance, je crée une configuration réseau spécifique pour OpenVPN.<br /><div class="separator" style="clear: both; text-align: center;"><img border="0" src="//2.bp.blogspot.com/-ief7DxMoUfQ/VKPpfIO-ezI/AAAAAAAAFXQ/Hxh7Yff9WLg/s1600/S%C3%A9lection_001.png" height="475" width="640" /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Puis j'autorise l'accès aux ports dont j'aurai besoin par la suite : tcp:943 pour l'admin et la connexion initiale, tcp:443 et udp:1194 pour les connexions VPN. N'oublions pas d'autoriser tcp:22 pour les connexions SSH.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><img border="0" src="//2.bp.blogspot.com/-byVO6HHSDd8/VKPqD-3BUeI/AAAAAAAAFXY/M3A6v_Eg7vs/s1600/S%C3%A9lection_001.png" height="332" width="640" /></div><div class="separator" style="clear: both; text-align: left;"><br /></div>Je peux ensuite créer mon instance. J'ai choisi une toute petite configuration, avec Ubuntu 14.10, localisée en Europe de l'Ouest.<br /><div class="separator" style="clear: both; text-align: center;"><img border="0" src="//3.bp.blogspot.com/-eJBJcOT3ki4/VKPq45msyXI/AAAAAAAAFXk/zP2Gcgg1VlA/s1600/S%C3%A9lection_002.png" height="569" width="640" /></div><br />Lors de la création, je rattache mon instance à la configuration réseau, et j'affecte une adresse IP fixe.<br /><div class="separator" style="clear: both; text-align: center;"><img border="0" src="//4.bp.blogspot.com/-OfKmJh3mmUQ/VKPrI4hIJNI/AAAAAAAAFXs/vBPxftQ2fOk/s1600/S%C3%A9lection_003.png" height="145" width="400" /></div>Bien sûr, j'aurais pu faire tout ça en ligne de commande avec le SDK de Google Cloud.<br /><br /><b>Installer et&nbsp;</b><b>configurer</b><b>&nbsp;OpenVPN AS</b><br /><b><br /></b>Ma machine est prête, je peux m'y connecter et suivre la procédure de Korben...<br /><br /><pre>sudo apt-get install openvpn<br />wget http://swupdate.openvpn.org/as/openvpn-as-2.0.11-Ubuntu14.amd_64.deb<br />sudo dpkg -i openvpn-as-2.0.11-Ubuntu14.amd_64.deb<br /></pre><br />... je suis toutes les étapes de configuration du serveur.<br /><br /><b>Configurer OpenVPN AS pour Google Cloud</b><br /><div><br /></div><div>Avec la configuration standard, le client n'arrivera pas à se connecter parce que ma machine a une adresse IP interne et une adresse IP externe. Or OpenVPN AS ne connait que l'adresse interne et fournira donc une configuration erronée au client. Il faut donc lui indiquer la bonne adresse, dans la section "Server Network Settings".</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><img border="0" src="//1.bp.blogspot.com/-3IAy5GP9XpY/VKPvrp_qITI/AAAAAAAAFYA/HDksXTxfwng/s1600/S%C3%A9lection_004b.png" height="232" width="400" /></div><div><br /></div><div class="separator" style="clear: both; text-align: center;"></div><div><b>Connecter le client OpenVPN</b></div><div><br /></div><div>Voilà, je peux reprendre la procédure de Korben pour importer le profil d'accès dans mon client.</div><div><br /></div><div><b>Conclusion</b></div><div><br /></div><div>La procédure est à peine plus compliquée, par contre le coût risque d'être plus important que chez OVH. La plus petite instance coûte quelques euros par mois et ça peut vite grimper pour des machines plus puissantes ; faite votre propre estimation à partir des <a href="https://cloud.google.com/compute/" target="_blank">tarifs</a>.<br /><br /></div>