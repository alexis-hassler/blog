---
layout: post
title: Installation de Silverpeas
date: '2010-02-11T21:05:00.033+01:00'
author: Alexis Hassler
tags:
- Silverpeas
modified_time: '2010-03-31T13:20:24.037+02:00'
blogger_id: tag:blogger.com,1999:blog-1829028238633284708.post-9169245830941246739
blogger_orig_url: http://blog.alexis-hassler.com/2010/02/installation-de-silverpeas.html

---

Pour aujourd'hui, je me lance dans une installation de <a href="http://www.silverpeas.com/">Silverpeas</a> v5, la première version libre. Je pars sur une installation standard, c'est à dire avec JBoss 4.0, le serveur d'application préconisé. Celui-ci est un peu vieillot, mais si ça fonctionne, ce sera un bon début. J'essaierai plus tard sur un JBoss plus récent et/ou un Jonas.<br /><br />J'ai déroulé la procédure d'installation du début à la fin, sur une machine virtuelle vierge, sous Linux. J'ai utilisé une version de Silverpeas qui n'est pas finalisée, ce qui peut se ressentir à certaines étapes.<br /><!--more--><h4>Vérification des prérequis</h4>Mon installation va être faite sur une machine virtuelle Debian 5, avec VirtualBox. Ma configuration standard embarque un JDK 6 (openjdk). Par contre, elle n'a pas Maven, et la version de Maven proposée dans les dépôts est une 2.0. Or l'installation de Silverpeas requiert une version 2.2. Je vais donc le télécharger depuis mon miroir préféré.<br /><pre class="brush: shell">cd ~/tmp/<br />wget ftp://mir1.ovh.net/ftp.apache.org/dist/maven/binaries/apache-maven-2.2.1-bin.tar.gz<br />wget http://www.eu.apache.org/dist/maven/binaries/apache-maven-2.2.1-bin.tar.gz.asc<br />wget http://www.eu.apache.org/dist/maven/KEYS<br />gpg --import KEYS<br />if gpg --verify apache-maven-2.2.1-bin.tar.gz.asc<br />then<br />  cd /opt<br />  tar -xf ~/tmp/apache-maven-2.2.1-bin.tar.gz<br />fi<br /></pre>Dernier pré-requis : la base de données. Il faut que j'installe postgresql. Là je ne vais pas peaufiner, la version des dépôts fera l'affaire ; c'est d'ailleurs ce qui est suggéré dans la doc.<br /><pre class="brush: shell">apt-get install -y postgresql<br /></pre>Je dois ensuite préparer la base.<br /><pre class="brush: shell">su postgres <br />psql -d template1 -c "ALTER USER postgres WITH PASSWORD 'postgres'"<br />createdb -E UTF-8 SilverpeasV5<br />exit<br /></pre>Avant de quitter la session postgres, je peux vérifier que ma base a bien été créée avec la commande "psql -l". <br /><h4>Préparation de l'installation</h4>Je me rends donc sur la page d'<a href="http://repository.silverpeas.org/docs/core/installation.html">installation de Silverpeas</a>, je relève les adresses de téléchargement, et je mets tout ça dans mon script.<br /><pre class="brush: shell">#!/bin/sh<br />mkdir ~/tmp/silverpeas<br />cd ~/tmp/silverpeas<br />wget http://repository.silverpeas.org/files/jboss403.tar.gz<br />wget http://repository.silverpeas.org/files/silverpeas-1.0-RC1.tar.gz<br /><br />mkdir /opt/silverpeas<br />cd /opt/silverpeas<br />tar -xf ~/tmp/silverpeas/jboss403.tar.gz<br />export JBOSS_HOME=/opt/silverpeas/jboss403/<br />mkdir /opt/silverpeas/sp<br />cd /opt/silverpeas/sp<br />tar -xf ~/tmp/silverpeas/silverpeas-1.0-RC1.tar.gz<br /></pre>Ensuite, la doc nous demande d'éditer setup/settings/JBossSettings.xml. Dans ce fichier, il faut juste paramétrer le port sur lequel va écouter JBoss et la mémoire heap. Comme je travaille sur une machine virtuelle toute neuve, je n'ai pas de conflit de port, je garde donc les valeurs par défaut. Vient au tour de setup/settings/SilverpeasSettings.xml. Là, je ne vois pas du tout ce que je dois faire, à part changer le mot de passe de la base, mais comme j'ai mis celui par défaut, je laisse tout tel quel.<br /><strike>La première impression à ce niveau, c'est que l'auteur de la documentation n'a pas l'air très à l'aise avec Linux puisque tous les chemins sont formatés à la Windows (oubliez cette phrase, c'est juste pour taquiner <a href="http://www.ehsavoie.com/">Emmanuel</a> de Silverpeas).</strike><br /><br />On peut maintenant renseigner les variables d'environnement :<br /><pre class="brush: shell">export JBOSS_HOME=/opt/silverpeas/jboss403/<br />export SILVERPEAS_HOME=/opt/silverpeas/sp<br />export JAVA_HOME=export JAVA_HOME=`update-java-alternatives -l | awk '{print $3}'`<br />export M2_HOME=/opt/apache-maven-2.2.1<br />export M2=$M2_HOME/bin<br />export PATH=$PATH:$M2<br /></pre><h4>Installation</h4>C'est parti pour la procédure d'installation à proprement parler. Il faut s'armer de patience ; maven, sur un serveur vierge, ce n'est pas idéal puisqu'il télécharge la moité d'internet (1500 fichiers, ici).<br /><pre class="brush: shell">cd $SILVERPEAS_HOME/bin<br />mvn clean install<br />./appBuilder.sh<br />./SilverpeasSettings.sh<br />./dbBuilder.sh<br /></pre><h4>C'est parti</h4>Ça y est, tout est prêt, on peut démarrer :<br /><pre class="brush: shell">$SILVERPEAS_HOME/bin/silverpeas_start_jboss.sh </pre>Et là, patatra, ça ne marche pas. Bon, je rappelle que j'ai fait mes essais sur une version qui n'est pas finale. Un coup d'œil aux log et une petite recherche dans la configuration me mènent au fichier $JBOSS_HOME/server/default/deploy/jbossweb_tomcat55.sar/server.xml dans lequel sont déclarés de contextes. L'idée est plutôt saugrenue, c'est plutôt un mode de déploiement qui était prévu pour un Tomcat autonome, et qui est obsolète ! Enfin, si ça marche.<br />Je corrige donc les chemins qui ressemblent à du Windows (hum hum).<br /><pre class="brush: xml">&nbsp; &lt;context docbase="/opt/silverpeas/sp/data/weblib" path="/weblib" /&gt;<br />&nbsp; &lt;context docbase="/opt/silverpeas/sp/data/website" path="/website"/&gt;</pre>Pour la partie help, j'ai préféré désactiver le contexte car je n'ai pas trouvé les répertoires.<br /><br />Moyennant ces modifications, ça fonctionne, j'accède à l'écran d'accueil à l'adresse http://myserver:8000/ et me connecter avec le login et mot de passe <b>SilverAdmin</b> / <b>SilverAdmin</b>.<br /><br /><h4>Conclusion</h4>A part quelques imprécision dans la procédure d'installation, cette version SP1 semble déjà stable et tout à fait utilisable. Gageons la la version SP2 saura corriger cela. A quand la version finale.